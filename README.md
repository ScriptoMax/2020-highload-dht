# Оценка времени отклика сервера при установлении соединений с множеством клиентов (wrk + async-profiler)   

Сведения о системе:<br/>
ОС Ubuntu 18.04 LTS x64-bit <br/>
Процессор Intel(R) Celeron(R) N4000 CPU @ 1.10GHz<br/>
Объём RAM: 8 ГБ<br/>
Количество ядер ЦПУ: 2<br/>  
Версия wrk 
Версия async-profiler

## Этап 1. HTTP + storage (deadline 2020-09-30)
### Fork

**PUT basic stress test summary** 
```
max@max-Inspiron-15-3573:~/hackdht$ wrk -t2 -c16 -d7m -s src/profiling/wrk_scripts/put.lua -R15000 --latency http://127.0.0.1:8080
Running 7m test @ http://127.0.0.1:8080
  2 threads and 16 connections
  Thread calibration: mean lat.: 832.860ms, rate sampling interval: 2615ms
  Thread calibration: mean lat.: 591.388ms, rate sampling interval: 2580ms
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency    10.02s    16.30s    0.88m    80.49%
    Req/Sec     6.79k     1.26k    8.96k    69.43%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%   25.87ms
 75.000%   20.23s 
 90.000%   40.11s 
 99.000%    0.86m 
 99.900%    0.88m 
 99.990%    0.88m 
 99.999%    0.88m 
100.000%    0.88m 

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.089     0.000000            1         1.00
       1.034     0.100000       557448         1.11
       1.660     0.200000      1113804         1.25
       2.775     0.300000      1671148         1.43
       7.627     0.400000      2227613         1.67
      25.871     0.500000      2784552         2.00
      61.919     0.550000      3062897         2.22
     186.495     0.600000      3341377         2.50
    1345.535     0.650000      3619764         2.86
    9519.103     0.700000      3898296         3.33
   20234.239     0.750000      4177463         4.00
   24444.927     0.775000      4316275         4.44
   26165.247     0.800000      4456403         5.00
   27574.271     0.825000      4595120         5.71
   28491.775     0.850000      4736040         6.67
   29720.575     0.875000      4872988         8.00
   34799.615     0.887500      4942341         8.89
   40108.031     0.900000      5012151        10.00
   45121.535     0.912500      5081754        11.43
   47087.615     0.925000      5152294        13.33
   47874.047     0.937500      5221402        16.00
   48365.567     0.943750      5256137        17.78
   48758.783     0.950000      5290940        20.00
   49414.143     0.956250      5326047        22.86
   50167.807     0.962500      5362437        26.67
   50397.183     0.968750      5394902        32.00
   50528.255     0.971875      5416367        35.56
   50626.559     0.975000      5432805        40.00
   50724.863     0.978125      5450429        45.71
   50823.167     0.981250      5465005        53.33
   51019.775     0.984375      5483046        64.00
   51150.847     0.985938      5493014        71.11
   51281.919     0.987500      5500261        80.00
   51445.759     0.989062      5508359        91.43
   51609.599     0.990625      5519761       106.67
   51707.903     0.992188      5525934       128.00
   51773.439     0.992969      5533811       142.22
   51806.207     0.993750      5537257       160.00
   51838.975     0.994531      5540134       182.86
   51904.511     0.995313      5544096       213.33
   51970.047     0.996094      5547477       256.00
   52232.191     0.996484      5549828       284.44
   52297.727     0.996875      5551485       320.00
   52363.263     0.997266      5553811       365.71
   52461.567     0.997656      5556463       426.67
   52527.103     0.998047      5558097       512.00
   52559.871     0.998242      5559516       568.89
   52592.639     0.998437      5561653       640.00
   52592.639     0.998633      5561653       731.43
   52625.407     0.998828      5563662       853.33
   52625.407     0.999023      5563662      1024.00
   52658.175     0.999121      5564723      1137.78
   52658.175     0.999219      5564723      1280.00
   52690.943     0.999316      5566174      1462.86
   52690.943     0.999414      5566174      1706.67
   52690.943     0.999512      5566174      2048.00
   52723.711     0.999561      5567609      2275.56
   52723.711     0.999609      5567609      2560.00
   52723.711     0.999658      5567609      2925.71
   52723.711     0.999707      5567609      3413.33
   52723.711     0.999756      5567609      4096.00
   52723.711     0.999780      5567609      4551.11
   52756.479     0.999805      5568606      5120.00
   52756.479     0.999829      5568606      5851.43
   52756.479     0.999854      5568606      6826.67
   52756.479     0.999878      5568606      8192.00
   52756.479     0.999890      5568606      9102.22
   52756.479     0.999902      5568606     10240.00
   52756.479     0.999915      5568606     11702.86
   52756.479     0.999927      5568606     13653.33
   52756.479     0.999939      5568606     16384.00
   52756.479     0.999945      5568606     18204.44
   52756.479     0.999951      5568606     20480.00
   52756.479     0.999957      5568606     23405.71
   52789.247     0.999963      5568794     27306.67
   52789.247     0.999969      5568794     32768.00
   52789.247     0.999973      5568794     36408.89
   52789.247     0.999976      5568794     40960.00
   52789.247     0.999979      5568794     46811.43
   52789.247     0.999982      5568794     54613.33
   52789.247     0.999985      5568794     65536.00
   52789.247     0.999986      5568794     72817.78
   52789.247     0.999988      5568794     81920.00
   52789.247     0.999989      5568794     93622.86
   52789.247     0.999991      5568794    109226.67
   52789.247     0.999992      5568794    131072.00
   52789.247     0.999993      5568794    145635.56
   52789.247     0.999994      5568794    163840.00
   52789.247     0.999995      5568794    187245.71
   52822.015     0.999995      5568808    218453.33
   52822.015     0.999996      5568808    262144.00
   52822.015     0.999997      5568808    291271.11
   52822.015     0.999997      5568808    327680.00
   52822.015     0.999997      5568808    374491.43
   52854.783     0.999998      5568821    436906.67
   52854.783     1.000000      5568821          inf
#[Mean    =    10024.596, StdDeviation   =    16301.020]
#[Max     =    52822.016, Total count    =      5568821]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  5713347 requests in 7.00m, 365.06MB read
Requests/sec:  13603.24
Transfer/sec:      0.87MB

```
![basic_put_cpu](https://user-images.githubusercontent.com/55311053/95130981-0b258900-0766-11eb-9d61-fe3578f961bf.jpg)
![basic_put_alloc](https://user-images.githubusercontent.com/55311053/95130978-09f45c00-0766-11eb-8492-cf0bae70a540.jpg)
![basic_put_lock](https://user-images.githubusercontent.com/55311053/95130987-0bbe1f80-0766-11eb-9349-4d02bbfacc30.jpg)

**GET basic stress test results**
```

max@max-Inspiron-15-3573:~/hackdht$ wrk -t2 -c16 -d7m -s src/profiling/wrk_scripts/get.lua -R15000 --latency http://127.0.0.1:8080
Running 7m test @ http://127.0.0.1:8080
  2 threads and 16 connections
  Thread calibration: mean lat.: 81.320ms, rate sampling interval: 621ms
  Thread calibration: mean lat.: 73.586ms, rate sampling interval: 499ms
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency   143.24ms  340.25ms   2.43s    88.25%
    Req/Sec     3.85k     2.39k   11.01k    65.77%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%    1.66ms
 75.000%   59.39ms
 90.000%  571.39ms
 99.000%    1.71s 
 99.900%    2.18s 
 99.990%    2.38s 
 99.999%    2.42s 
100.000%    2.43s 

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.082     0.000000            1         1.00
       0.471     0.100000       319969         1.11
       0.692     0.200000       638488         1.25
       0.912     0.300000       956410         1.43
       1.186     0.400000      1275640         1.67
       1.664     0.500000      1593748         2.00
       2.319     0.550000      1753228         2.22
       3.847     0.600000      1912476         2.50
       7.411     0.650000      2071814         2.86
      18.383     0.700000      2231143         3.33
      59.391     0.750000      2390446         4.00
      91.647     0.775000      2470119         4.44
     140.543     0.800000      2549965         5.00
     212.351     0.825000      2629489         5.71
     306.175     0.850000      2709287         6.67
     440.831     0.875000      2788852         8.00
     507.391     0.887500      2828686         8.89
     571.391     0.900000      2868715        10.00
     631.295     0.912500      2908394        11.43
     701.951     0.925000      2948396        13.33
     774.143     0.937500      2988314        16.00
     815.615     0.943750      3007981        17.78
     855.551     0.950000      3027967        20.00
     906.751     0.956250      3047828        22.86
    1001.983     0.962500      3067740        26.67
    1140.735     0.968750      3087757        32.00
    1208.319     0.971875      3097691        35.56
    1266.687     0.975000      3107702        40.00
    1337.343     0.978125      3117618        45.71
    1445.887     0.981250      3127527        53.33
    1529.855     0.984375      3137534        64.00
    1574.911     0.985938      3142431        71.11
    1615.871     0.987500      3147510        80.00
    1665.023     0.989062      3152390        91.43
    1746.943     0.990625      3157365       106.67
    1835.007     0.992188      3162404       128.00
    1869.823     0.992969      3164911       142.22
    1902.591     0.993750      3167335       160.00
    1928.191     0.994531      3169873       182.86
    1951.743     0.995313      3172332       213.33
    1985.535     0.996094      3174813       256.00
    2013.183     0.996484      3176061       284.44
    2031.615     0.996875      3177285       320.00
    2050.047     0.997266      3178550       365.71
    2074.623     0.997656      3179806       426.67
    2096.127     0.998047      3181044       512.00
    2105.343     0.998242      3181713       568.89
    2113.535     0.998437      3182260       640.00
    2121.727     0.998633      3182902       731.43
    2148.351     0.998828      3183517       853.33
    2181.119     0.999023      3184132      1024.00
    2205.695     0.999121      3184448      1137.78
    2224.127     0.999219      3184759      1280.00
    2236.415     0.999316      3185077      1462.86
    2244.607     0.999414      3185404      1706.67
    2260.991     0.999512      3185796      2048.00
    2265.087     0.999561      3185864      2275.56
    2271.231     0.999609      3186002      2560.00
    2289.663     0.999658      3186178      2925.71
    2310.143     0.999707      3186313      3413.33
    2318.335     0.999756      3186462      4096.00
    2326.527     0.999780      3186552      4551.11
    2332.671     0.999805      3186660      5120.00
    2338.815     0.999829      3186704      5851.43
    2355.199     0.999854      3186788      6826.67
    2369.535     0.999878      3186857      8192.00
    2373.631     0.999890      3186897      9102.22
    2375.679     0.999902      3186942     10240.00
    2379.775     0.999915      3186979     11702.86
    2383.871     0.999927      3187027     13653.33
    2385.919     0.999939      3187046     16384.00
    2392.063     0.999945      3187069     18204.44
    2394.111     0.999951      3187086     20480.00
    2398.207     0.999957      3187108     23405.71
    2402.303     0.999963      3187135     27306.67
    2406.399     0.999969      3187147     32768.00
    2408.447     0.999973      3187159     36408.89
    2410.495     0.999976      3187170     40960.00
    2412.543     0.999979      3187179     46811.43
    2414.591     0.999982      3187187     54613.33
    2416.639     0.999985      3187196     65536.00
    2418.687     0.999986      3187204     72817.78
    2418.687     0.999988      3187204     81920.00
    2420.735     0.999989      3187211     93622.86
    2420.735     0.999991      3187211    109226.67
    2422.783     0.999992      3187216    131072.00
    2424.831     0.999993      3187220    145635.56
    2426.879     0.999994      3187224    163840.00
    2426.879     0.999995      3187224    187245.71
    2428.927     0.999995      3187230    218453.33
    2428.927     0.999996      3187230    262144.00
    2428.927     0.999997      3187230    291271.11
    2430.975     0.999997      3187240    327680.00
    2430.975     1.000000      3187240          inf
#[Mean    =      143.240, StdDeviation   =      340.248]
#[Max     =     2428.928, Total count    =      3187240]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  3337521 requests in 7.00m, 217.50MB read
  Socket errors: connect 0, read 0, write 0, timeout 1565
Requests/sec:   7944.35
Transfer/sec:    530.13KB


```
![basic_get_cpu](https://user-images.githubusercontent.com/55311053/95130974-08c32f00-0766-11eb-9946-c2f8200ad02f.jpg)
![basic_get_alloc](https://user-images.githubusercontent.com/55311053/95130969-07920200-0766-11eb-8227-e1384a6b136b.jpg)
![basic_get_lock](https://user-images.githubusercontent.com/55311053/95130975-095bc580-0766-11eb-87ef-65f12f906b06.jpg)

**PUT summary for extended DB config test**
```
max@max-Inspiron-15-3573:~/hackdht$ wrk -t2 -c16 -d7m -s src/profiling/wrk_scripts/put.lua -R15000 --latency http://127.0.0.1:8080
Running 7m test @ http://127.0.0.1:8080
  2 threads and 16 connections
  Thread calibration: mean lat.: 26.194ms, rate sampling interval: 201ms
  Thread calibration: mean lat.: 18.978ms, rate sampling interval: 133ms
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency    12.49s    12.68s   35.78s    76.05%
    Req/Sec     7.35k     1.84k   12.90k    68.66%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%    8.90s 
 75.000%   24.84s 
 90.000%   33.46s 
 99.000%   35.09s 
 99.900%   35.62s 
 99.990%   35.78s 
 99.999%   35.82s 
100.000%   35.82s 

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.094     0.000000            1         1.00
      11.559     0.100000       599186         1.11
     197.631     0.200000      1198364         1.25
    1274.879     0.300000      1797676         1.43
    3741.695     0.400000      2396601         1.67
    8904.703     0.500000      2995859         2.00
   10747.903     0.550000      3296033         2.22
   12378.111     0.600000      3596286         2.50
   14581.759     0.650000      3895548         2.86
   20758.527     0.700000      4194895         3.33
   24838.143     0.750000      4494202         4.00
   26574.847     0.775000      4644454         4.44
   28573.695     0.800000      4796510         5.00
   29982.719     0.825000      4943559         5.71
   31817.727     0.850000      5093407         6.67
   32997.375     0.875000      5245617         8.00
   33292.287     0.887500      5319128         8.89
   33456.127     0.900000      5400527        10.00
   33652.735     0.912500      5483072        11.43
   33751.039     0.925000      5545853        13.33
   33914.879     0.937500      5623243        16.00
   34013.183     0.943750      5659705        17.78
   34144.255     0.950000      5708296        20.00
   34209.791     0.956250      5744134        22.86
   34308.095     0.962500      5776514        26.67
   34439.167     0.968750      5805344        32.00
   34537.471     0.971875      5831882        35.56
   34635.775     0.975000      5847271        40.00
   34701.311     0.978125      5862238        45.71
   34799.615     0.981250      5882337        53.33
   34897.919     0.984375      5903284        64.00
   34930.687     0.985938      5909191        71.11
   34996.223     0.987500      5920035        80.00
   35061.759     0.989062      5930398        91.43
   35094.527     0.990625      5935498       106.67
   35192.831     0.992188      5948947       128.00
   35225.599     0.992969      5953598       142.22
   35258.367     0.993750      5957053       160.00
   35291.135     0.994531      5960947       182.86
   35323.903     0.995313      5964746       213.33
   35356.671     0.996094      5968515       256.00
   35389.439     0.996484      5971103       284.44
   35422.207     0.996875      5973707       320.00
   35454.975     0.997266      5976017       365.71
   35487.743     0.997656      5978604       426.67
   35520.511     0.998047      5980999       512.00
   35520.511     0.998242      5980999       568.89
   35553.279     0.998437      5982931       640.00
   35586.047     0.998633      5985178       731.43
   35586.047     0.998828      5985178       853.33
   35618.815     0.999023      5986588      1024.00
   35618.815     0.999121      5986588      1137.78
   35651.583     0.999219      5988182      1280.00
   35651.583     0.999316      5988182      1462.86
   35651.583     0.999414      5988182      1706.67
   35684.351     0.999512      5988952      2048.00
   35684.351     0.999561      5988952      2275.56
   35717.119     0.999609      5989495      2560.00
   35717.119     0.999658      5989495      2925.71
   35749.887     0.999707      5990388      3413.33
   35749.887     0.999756      5990388      4096.00
   35749.887     0.999780      5990388      4551.11
   35749.887     0.999805      5990388      5120.00
   35782.655     0.999829      5990846      5851.43
   35782.655     0.999854      5990846      6826.67
   35782.655     0.999878      5990846      8192.00
   35782.655     0.999890      5990846      9102.22
   35782.655     0.999902      5990846     10240.00
   35815.423     0.999915      5991416     11702.86
   35815.423     1.000000      5991416          inf
#[Mean    =    12492.578, StdDeviation   =    12679.580]
#[Max     =    35782.656, Total count    =      5991416]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  6141739 requests in 7.00m, 392.43MB read
Requests/sec:  14623.20
Transfer/sec:      0.93MB


```
![revised_put_cpu](https://user-images.githubusercontent.com/55311053/95130998-0f51a680-0766-11eb-9049-ed30dad77d58.jpg)
![revised_put_alloc](https://user-images.githubusercontent.com/55311053/95130996-0eb91000-0766-11eb-9ca8-4598b4c7f0c2.jpg)
![revised_put_lock](https://user-images.githubusercontent.com/55311053/95131001-0fea3d00-0766-11eb-9f2e-b4ad148c948c.jpg)


**GET summary for extended DB config test**
```
max@max-Inspiron-15-3573:~/hackdht$ wrk -t2 -c16 -d7m -s src/profiling/wrk_scripts/get.lua -R15000 --latency http://127.0.0.1:8080
Running 7m test @ http://127.0.0.1:8080
  2 threads and 16 connections
  Thread calibration: mean lat.: 204.903ms, rate sampling interval: 1254ms
  Thread calibration: mean lat.: 176.419ms, rate sampling interval: 877ms
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     3.46ms   21.37ms 444.42ms   98.63%
    Req/Sec     1.99k   688.37     8.91k    96.85%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%  836.00us
 75.000%    1.27ms
 90.000%    4.40ms
 99.000%   41.34ms
 99.900%  373.50ms
 99.990%  443.90ms
 99.999%  444.42ms
100.000%  444.67ms

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.092     0.000000            1         1.00
       0.303     0.100000       164131         1.11
       0.447     0.200000       326193         1.25
       0.572     0.300000       489343         1.43
       0.714     0.400000       652395         1.67
       0.836     0.500000       815399         2.00
       0.902     0.550000       897199         2.22
       0.982     0.600000       977693         2.50
       1.074     0.650000      1059616         2.86
       1.155     0.700000      1141399         3.33
       1.267     0.750000      1222055         4.00
       1.400     0.775000      1262837         4.44
       1.636     0.800000      1303535         5.00
       1.978     0.825000      1344202         5.71
       2.463     0.850000      1385004         6.67
       3.233     0.875000      1425681         8.00
       3.783     0.887500      1446045         8.89
       4.399     0.900000      1466435        10.00
       5.095     0.912500      1486804        11.43
       5.903     0.925000      1507151        13.33
       6.831     0.937500      1527488        16.00
       7.415     0.943750      1537651        17.78
       8.115     0.950000      1547866        20.00
       8.919     0.956250      1558024        22.86
      10.007     0.962500      1568188        26.67
      11.511     0.968750      1578370        32.00
      12.463     0.971875      1583469        35.56
      13.655     0.975000      1588555        40.00
      15.311     0.978125      1593652        45.71
      17.599     0.981250      1598752        53.33
      21.487     0.984375      1603843        64.00
      24.111     0.985938      1606379        71.11
      27.679     0.987500      1608919        80.00
      34.815     0.989062      1611466        91.43
      45.663     0.990625      1614008       106.67
      60.191     0.992188      1616558       128.00
      75.071     0.992969      1617837       142.22
      94.271     0.993750      1619101       160.00
     109.311     0.994531      1620381       182.86
     128.895     0.995313      1621646       213.33
     168.575     0.996094      1622919       256.00
     196.479     0.996484      1623557       284.44
     245.631     0.996875      1624192       320.00
     280.831     0.997266      1624830       365.71
     296.703     0.997656      1625471       426.67
     316.415     0.998047      1626100       512.00
     328.703     0.998242      1626427       568.89
     335.871     0.998437      1626741       640.00
     346.879     0.998633      1627056       731.43
     360.447     0.998828      1627373       853.33
     374.783     0.999023      1627701      1024.00
     380.415     0.999121      1627858      1137.78
     385.791     0.999219      1628015      1280.00
     388.607     0.999316      1628216      1462.86
     395.519     0.999414      1628329      1706.67
     404.223     0.999512      1628522      2048.00
     404.479     0.999561      1628593      2275.56
     405.503     0.999609      1628649      2560.00
     412.415     0.999658      1628726      2925.71
     417.791     0.999707      1628824      3413.33
     418.047     0.999756      1628893      4096.00
     418.303     0.999780      1628937      4551.11
     421.887     0.999805      1628967      5120.00
     428.799     0.999829      1629007      5851.43
     433.407     0.999854      1629046      6826.67
     436.223     0.999878      1629086      8192.00
     439.807     0.999890      1629104      9102.22
     443.903     0.999902      1629149     10240.00
     443.903     0.999915      1629149     11702.86
     444.159     0.999927      1629218     13653.33
     444.159     0.999939      1629218     16384.00
     444.159     0.999945      1629218     18204.44
     444.159     0.999951      1629218     20480.00
     444.159     0.999957      1629218     23405.71
     444.415     0.999963      1629268     27306.67
     444.415     0.999969      1629268     32768.00
     444.415     0.999973      1629268     36408.89
     444.415     0.999976      1629268     40960.00
     444.415     0.999979      1629268     46811.43
     444.415     0.999982      1629268     54613.33
     444.415     0.999985      1629268     65536.00
     444.415     0.999986      1629268     72817.78
     444.415     0.999988      1629268     81920.00
     444.415     0.999989      1629268     93622.86
     444.415     0.999991      1629268    109226.67
     444.671     0.999992      1629282    131072.00
     444.671     1.000000      1629282          inf
#[Mean    =        3.457, StdDeviation   =       21.370]
#[Max     =      444.416, Total count    =      1629282]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  1775561 requests in 7.00m, 114.93MB read
  Socket errors: connect 0, read 0, write 0, timeout 2395
Requests/sec:   4227.53
Transfer/sec:    280.21KB

```
![revised_get_cpu](https://user-images.githubusercontent.com/55311053/95130991-0d87e300-0766-11eb-9a6b-792989c0b0ed.jpg)
![revised_get_alloc](https://user-images.githubusercontent.com/55311053/95130988-0c56b600-0766-11eb-95a0-4644eb4dcd36.jpg)
![revised_get_lock](https://user-images.githubusercontent.com/55311053/95130994-0e207980-0766-11eb-9f1e-8d680efb9368.jpg)

