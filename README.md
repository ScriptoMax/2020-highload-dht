# Мониторинг работы сервера с поддержкой параллельных соединений (<em>wrk</em> + <em>async-profiler</em>)

**Система и программные средства** 
| | |
|-|-|
| ОС | Ubuntu Linux 18.04 LTS x64-bit |
| ЦПУ | Intel(R) Celeron(R) N4000 CPU @ 1.10GHz |
| Объём RAM | 8 ГБ |
| Количество ядер ЦПУ | 2 |
| [wrk](https://github.com/giltene/wrk2) | v. 4.0.0 |
| [async-profiler](https://github.com/jvm-profiling-tools/async-profiler) | 1.8.1 |
| [VisualVM](https://visualvm.github.io/) | 2.0.4 |

В исследовании производительности, предпринятом на отчётном этапе, рассмотрены показатели работы HTTP-сервера в различных программных конфигурациях RocksDB: базовой и расширенной, включающей ряд опций с ожидаемым уменьшением времени отклика за счёт оптимизации параллелизма.<br/> 
Нагрузочные испытания, проведённые с использованием <em>wrk</em>, организованы в виде серий PUT- и GET-запросов (длительность каждой - 7 минут) в условиях симулирования обмена данными с множеством клиентов (число клиентов установлено равным 16, количество параллельных потоков - 2 по числу ядер ЦПУ). Интенсивность генерации / отправки запросов каждого вида задана равной 15000 запросов/с (значение выбрано исходя из предварительных оценок интенсивности генерации запросов (<em>Requests/sec</em>) через <em>wrk</em> в сравнении с ориентиром (<em>Rate</em>)).

**Команды <em>wrk</em>**<br/>
<p></p>
<ins><em>wrk</em> | PUT</ins>
```
wrk -t2 -c16 -d7m -s src/profiling/wrk_scripts/put.lua -R15000 --latency http://127.0.0.1:8080
```

<ins><em>wrk</em> | GET</ins>
```
wrk -t2 -c16 -d7m -s src/profiling/wrk_scripts/get.lua -R15000 --latency http://127.0.0.1:8080
```

**Команды <em>async-profiler</em>**<br/>
<p></p>
<ins><em>async-profiler</em> | cpu</ins>
```
./profiler.sh -d 60 -e cpu -f /path/to/output/folder/flame_output_cpu.svg <server_process_pid>
```

<ins><em>async-profiler</em> | alloc</ins>
```
./profiler.sh -d 60 -e alloc -f /path/to/output/folder/flame_output_alloc.svg <server_process_pid>
```

<ins><em>async-profiler</em> | cpu</ins>
```
./profiler.sh -d 60 -e lock -f /path/to/output/folder/flame_output_lock.svg <server_pid>
```

Результаты мониторинга для различных конфигураций хранилища приведены далее.  

## 1. RocksDB - базовая конфигурация (без оптимизации параллелизма)

<ins>Код в TaskDAO.java</ins>
```
public TaskDAO(@NotNull final File data) throws IOException {
            final Options opts = new Options();
            opts.setCreateIfMissing(true); // create db instance if one does not exist
            opts.setParanoidChecks(false); // drops strict data quality control while performing search for corrupt / erroneous elements
            opts.setSkipStatsUpdateOnDbOpen(true); // declines statistics updates every time db is opening to run           

            dbLocalDir = data;
            try {
                Files.createDirectories(dbLocalDir.getParentFile().toPath());
                Files.createDirectories(dbLocalDir.getAbsoluteFile().toPath());
                db = RocksDB.open(opts, dbLocalDir.getAbsolutePath());
            } catch (IOException | RocksDBException exc) {
                logger.log(Level.SEVERE, "Storage initialization failed", exc);
            }
        }
```

### 1.1. PUT

<ins>Вывод <em>wrk</em></ins>  
```
max@max-Inspiron-15-3573:~/hackdht$ wrk -t2 -c16 -d7m -s src/profiling/wrk_scripts/put.lua -R15000 --latency http://127.0.0.1:8080
Running 7m test @ http://127.0.0.1:8080
  2 threads and 16 connections
  Thread calibration: mean lat.: 38.205ms, rate sampling interval: 340ms
  Thread calibration: mean lat.: 100.639ms, rate sampling interval: 831ms
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     2.61ms   10.49ms 456.19ms   98.24%
    Req/Sec     7.51k   149.92     9.54k    95.41%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%    1.37ms
 75.000%    1.98ms
 90.000%    2.84ms
 99.000%   28.30ms
 99.900%  152.32ms
 99.990%  355.84ms
 99.999%  431.87ms
100.000%  456.45ms

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.072     0.000000            1         1.00
       0.552     0.100000       615475         1.11
       0.782     0.200000      1231636         1.25
       0.981     0.300000      1846356         1.43
       1.172     0.400000      2461222         1.67
       1.367     0.500000      3077684         2.00
       1.470     0.550000      3382991         2.22
       1.581     0.600000      3691561         2.50
       1.700     0.650000      3997819         2.86
       1.833     0.700000      4306661         3.33
       1.983     0.750000      4612436         4.00
       2.069     0.775000      4766242         4.44
       2.165     0.800000      4921090         5.00
       2.275     0.825000      5074633         5.71
       2.411     0.850000      5228732         6.67
       2.583     0.875000      5381609         8.00
       2.695     0.887500      5458200         8.89
       2.837     0.900000      5535236        10.00
       3.025     0.912500      5611671        11.43
       3.307     0.925000      5688389        13.33
       3.865     0.937500      5765050        16.00
       4.391     0.943750      5803552        17.78
       5.135     0.950000      5841916        20.00
       6.039     0.956250      5880462        22.86
       7.031     0.962500      5918846        26.67
       8.231     0.968750      5957291        32.00
       8.991     0.971875      5976562        35.56
       9.911     0.975000      5995726        40.00
      11.023     0.978125      6014891        45.71
      12.447     0.981250      6034093        53.33
      14.751     0.984375      6053313        64.00
      16.687     0.985938      6062954        71.11
      19.583     0.987500      6072509        80.00
      23.903     0.989062      6082150        91.43
      32.111     0.990625      6091732       106.67
      42.559     0.992188      6101343       128.00
      48.831     0.992969      6106159       142.22
      55.775     0.993750      6110942       160.00
      63.775     0.994531      6115755       182.86
      72.639     0.995313      6120570       213.33
      79.551     0.996094      6125377       256.00
      83.967     0.996484      6127762       284.44
      89.023     0.996875      6130173       320.00
      94.207     0.997266      6132570       365.71
     100.223     0.997656      6134970       426.67
     108.031     0.998047      6137376       512.00
     112.639     0.998242      6138574       568.89
     118.335     0.998437      6139776       640.00
     126.655     0.998633      6140974       731.43
     140.543     0.998828      6142175       853.33
     153.855     0.999023      6143372      1024.00
     161.407     0.999121      6143975      1137.78
     168.831     0.999219      6144571      1280.00
     177.023     0.999316      6145173      1462.86
     186.623     0.999414      6145773      1706.67
     207.871     0.999512      6146374      2048.00
     231.423     0.999561      6146674      2275.56
     244.735     0.999609      6146973      2560.00
     254.335     0.999658      6147276      2925.71
     264.191     0.999707      6147575      3413.33
     276.479     0.999756      6147877      4096.00
     283.903     0.999780      6148024      4551.11
     293.887     0.999805      6148176      5120.00
     306.175     0.999829      6148327      5851.43
     325.119     0.999854      6148478      6826.67
     339.711     0.999878      6148628      8192.00
     348.159     0.999890      6148700      9102.22
     357.119     0.999902      6148778     10240.00
     362.751     0.999915      6148851     11702.86
     377.087     0.999927      6148925     13653.33
     383.231     0.999939      6149005     16384.00
     387.839     0.999945      6149038     18204.44
     392.191     0.999951      6149080     20480.00
     399.871     0.999957      6149114     23405.71
     404.735     0.999963      6149156     27306.67
     410.623     0.999969      6149189     32768.00
     413.183     0.999973      6149207     36408.89
     418.047     0.999976      6149228     40960.00
     418.815     0.999979      6149245     46811.43
     422.399     0.999982      6149263     54613.33
     426.751     0.999985      6149282     65536.00
     428.543     0.999986      6149291     72817.78
     430.847     0.999988      6149300     81920.00
     431.359     0.999989      6149310     93622.86
     432.639     0.999991      6149319    109226.67
     435.711     0.999992      6149329    131072.00
     437.759     0.999993      6149333    145635.56
     440.575     0.999994      6149339    163840.00
     442.623     0.999995      6149343    187245.71
     444.671     0.999995      6149348    218453.33
     445.951     0.999996      6149352    262144.00
     446.207     0.999997      6149354    291271.11
     448.511     0.999997      6149357    327680.00
     449.535     0.999997      6149359    374491.43
     450.303     0.999998      6149362    436906.67
     450.559     0.999998      6149364    524288.00
     451.327     0.999998      6149365    582542.22
     452.351     0.999998      6149366    655360.00
     453.375     0.999999      6149367    748982.86
     454.143     0.999999      6149368    873813.33
     454.399     0.999999      6149371   1048576.00
     454.399     0.999999      6149371   1165084.44
     454.399     0.999999      6149371   1310720.00
     454.399     0.999999      6149371   1497965.71
     455.423     0.999999      6149373   1747626.67
     455.423     1.000000      6149373   2097152.00
     455.423     1.000000      6149373   2330168.89
     455.423     1.000000      6149373   2621440.00
     455.423     1.000000      6149373   2995931.43
     456.191     1.000000      6149374   3495253.33
     456.191     1.000000      6149374   4194304.00
     456.191     1.000000      6149374   4660337.78
     456.191     1.000000      6149374   5242880.00
     456.191     1.000000      6149374   5991862.86
     456.447     1.000000      6149375   6990506.67
     456.447     1.000000      6149375          inf
#[Mean    =        2.610, StdDeviation   =       10.489]
#[Max     =      456.192, Total count    =      6149375]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  6299696 requests in 7.00m, 402.53MB read
Requests/sec:  14999.34
Transfer/sec:      0.96MB
```
Согласно результирующей сводке, средняя задержка при обработке запросов на добавление записей составила около 2,6 мс при стандартном отклонении на уровне 98%. Каждую секунду сервер выполнял свыше 7500 запросов, в то время как интенсивность их подачи совпала с целевым значением (15000 запросов/с). В статистике квантильного распределения времён отклика максимальная длительность ответа определена равной 450 мс. При этом получение ответа сервера в 99,9% случаев оказалось быстрее худшего результата приблизительно в 3 раза.<br/>            
<ins>Flamegraph-анализ</ins><br/>  

![ext_cpu_put](https://user-images.githubusercontent.com/55311053/95475548-fd068100-098e-11eb-8399-7cac4f5f3571.jpg)
<p align="center">Рис.1. Выделение ресурса CPU при симулировании PUT-запросов</p>

![ext_alloc_put](https://user-images.githubusercontent.com/55311053/95475537-fb3cbd80-098e-11eb-941d-1c5bf2b90073.jpg)
<p align="center">Рис.2. Выделение ресурса RAM при симулировании PUT-запросов</p>

![ext_lock_put](https://user-images.githubusercontent.com/55311053/95475557-fe37ae00-098e-11eb-89a7-be050fd86f06.jpg)
<p align="center">Рис.3. Профиль lock/monitor при симулировании PUT-запросов</p>

Визуализация профиля ЦПУ позволяет сделать вывод о доминировании в общей структуре операций чтения, парсинга данных из буфера наряду с формированием и отправкой результирующих данных через сокет. Аналогичные процессы выступают основными триггерами аллокаций <br/>. Ввиду того, что RocksDB обеспечивает потокобезопасность по умолчанию, код проекта не содержит специальных методов для управления совместным доступом. По этой причине профилирование <em>lock/monitor</em> лишено релевантных объектов и соответствующие графы (как в данном испытании, так и в последующих) оказываются пустыми.                        

### 1.2. GET

<ins>Вывод <em>wrk</em></ins>
```
max@max-Inspiron-15-3573:~/hackdht$ wrk -t2 -c16 -d7m -s src/profiling/wrk_scripts/get.lua -R15000 --latency http://127.0.0.1:8080
Running 7m test @ http://127.0.0.1:8080
  2 threads and 16 connections
  Thread calibration: mean lat.: 9.964ms, rate sampling interval: 43ms
  Thread calibration: mean lat.: 4.564ms, rate sampling interval: 28ms
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     1.67ms    2.02ms 103.68ms   95.10%
    Req/Sec     7.62k   524.86    13.81k    88.84%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%    1.32ms
 75.000%    1.91ms
 90.000%    2.63ms
 99.000%    9.93ms
 99.900%   19.28ms
 99.990%   66.43ms
 99.999%   91.78ms
100.000%  103.74ms

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.058     0.000000            1         1.00
       0.507     0.100000       615154         1.11
       0.738     0.200000      1231240         1.25
       0.940     0.300000      1846745         1.43
       1.131     0.400000      2462011         1.67
       1.321     0.500000      3075605         2.00
       1.421     0.550000      3383520         2.22
       1.527     0.600000      3692120         2.50
       1.640     0.650000      3998942         2.86
       1.765     0.700000      4305277         3.33
       1.906     0.750000      4612665         4.00
       1.985     0.775000      4765825         4.44
       2.073     0.800000      4920917         5.00
       2.171     0.825000      5075002         5.71
       2.285     0.850000      5227293         6.67
       2.429     0.875000      5381142         8.00
       2.521     0.887500      5458918         8.89
       2.629     0.900000      5535384        10.00
       2.765     0.912500      5611733        11.43
       2.947     0.925000      5688570        13.33
       3.205     0.937500      5765072        16.00
       3.389     0.943750      5803603        17.78
       3.641     0.950000      5841965        20.00
       4.027     0.956250      5880366        22.86
       4.603     0.962500      5918849        26.67
       5.403     0.968750      5957188        32.00
       5.863     0.971875      5976454        35.56
       6.339     0.975000      5995595        40.00
       6.863     0.978125      6014848        45.71
       7.443     0.981250      6034056        53.33
       8.135     0.984375      6053228        64.00
       8.551     0.985938      6062892        71.11
       9.031     0.987500      6072563        80.00
       9.575     0.989062      6082120        91.43
      10.191     0.990625      6091684       106.67
      10.903     0.992188      6101334       128.00
      11.303     0.992969      6106075       142.22
      11.735     0.993750      6110926       160.00
      12.207     0.994531      6115687       182.86
      12.743     0.995313      6120516       213.33
      13.359     0.996094      6125275       256.00
      13.711     0.996484      6127698       284.44
      14.119     0.996875      6130094       320.00
      14.583     0.997266      6132508       365.71
      15.143     0.997656      6134898       426.67
      15.863     0.998047      6137279       512.00
      16.303     0.998242      6138493       568.89
      16.831     0.998437      6139693       640.00
      17.471     0.998633      6140900       731.43
      18.335     0.998828      6142090       853.33
      19.439     0.999023      6143294      1024.00
      20.143     0.999121      6143890      1137.78
      21.039     0.999219      6144497      1280.00
      22.191     0.999316      6145089      1462.86
      24.159     0.999414      6145687      1706.67
      27.103     0.999512      6146287      2048.00
      29.103     0.999561      6146587      2275.56
      32.431     0.999609      6146886      2560.00
      36.479     0.999658      6147187      2925.71
      40.511     0.999707      6147488      3413.33
      46.079     0.999756      6147788      4096.00
      50.175     0.999780      6147938      4551.11
      54.047     0.999805      6148088      5120.00
      57.343     0.999829      6148238      5851.43
      60.735     0.999854      6148389      6826.67
      63.487     0.999878      6148538      8192.00
      65.215     0.999890      6148613      9102.22
      66.943     0.999902      6148689     10240.00
      68.415     0.999915      6148765     11702.86
      70.143     0.999927      6148838     13653.33
      72.191     0.999939      6148914     16384.00
      73.279     0.999945      6148951     18204.44
      75.199     0.999951      6148988     20480.00
      77.695     0.999957      6149026     23405.71
      80.319     0.999963      6149064     27306.67
      82.303     0.999969      6149102     32768.00
      83.327     0.999973      6149120     36408.89
      84.543     0.999976      6149138     40960.00
      86.079     0.999979      6149157     46811.43
      87.807     0.999982      6149176     54613.33
      89.215     0.999985      6149195     65536.00
      89.919     0.999986      6149204     72817.78
      90.495     0.999988      6149213     81920.00
      91.327     0.999989      6149224     93622.86
      92.095     0.999991      6149232    109226.67
      92.863     0.999992      6149244    131072.00
      92.991     0.999993      6149246    145635.56
      93.823     0.999994      6149251    163840.00
      94.335     0.999995      6149256    187245.71
      95.231     0.999995      6149260    218453.33
      96.511     0.999996      6149265    262144.00
      96.959     0.999997      6149267    291271.11
      97.343     0.999997      6149270    327680.00
      97.919     0.999997      6149272    374491.43
      98.239     0.999998      6149274    436906.67
      99.135     0.999998      6149277    524288.00
      99.967     0.999998      6149278    582542.22
     100.095     0.999998      6149279    655360.00
     100.223     0.999999      6149280    748982.86
     100.351     0.999999      6149281    873813.33
     101.055     0.999999      6149283   1048576.00
     101.055     0.999999      6149283   1165084.44
     101.887     0.999999      6149284   1310720.00
     101.887     0.999999      6149284   1497965.71
     102.015     0.999999      6149285   1747626.67
     102.847     1.000000      6149286   2097152.00
     102.847     1.000000      6149286   2330168.89
     102.847     1.000000      6149286   2621440.00
     102.847     1.000000      6149286   2995931.43
     103.423     1.000000      6149287   3495253.33
     103.423     1.000000      6149287   4194304.00
     103.423     1.000000      6149287   4660337.78
     103.423     1.000000      6149287   5242880.00
     103.423     1.000000      6149287   5991862.86
     103.743     1.000000      6149288   6990506.67
     103.743     1.000000      6149288          inf
#[Mean    =        1.672, StdDeviation   =        2.016]
#[Max     =      103.680, Total count    =      6149288]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  6299593 requests in 7.00m, 412.42MB read
Requests/sec:  14998.98
Transfer/sec:      0.98MB

```
Результаты данной серии отражают существенное снижение времени отклика в сравнении с оценками, полученными  для операций добавления. При средней задержке около 1,7 мс и отклонении 95% сервер достиг интенсивности обработки на уровне 7600 запросов в секунду. В 99,9% случаев время ожидания отклика не превысило 20 мс, худший результат оказался близок 100 мс.<br/>                  

<ins>Flamegraph-анализ</ins><br/>  

![ext_cpu_get](https://user-images.githubusercontent.com/55311053/95475541-fbd55400-098e-11eb-8529-f1f4476e1bf1.jpg)
<p align="center">Рис.4. Выделение ресурса CPU при симулировании GET-запросов</p>

![ext_alloc_get](https://user-images.githubusercontent.com/55311053/95475533-fa0b9080-098e-11eb-9bf0-8116ad655060.jpg)
<p align="center">Рис.5. Выделение ресурса RAM при симулировании GET-запросов</p>

![ext_lock_get](https://user-images.githubusercontent.com/55311053/95475554-fe37ae00-098e-11eb-9491-9a7737c91617.jpg)
<p align="center">Рис.6. Профиль lock/monitor при симулировании GET-запросов</p>

Представленные графы в значительной мере воспроизводят профили, полученные для серии с операциями вставки. Как и в случае с последними, в структуре использования процессорного времени превалируют операции с буфером данных и сокетом. Дополнительную нагрузку на ресурс RAM создают операции преобразования типов данных между байтовыми и строковыми объектами.         

## 2. RocksDB - расширенная конфигурация (вариант оптимизации)

В качестве варианта улучшения реализации параллелизма в код конструктора экземпляра RocksDB были добавлены вызовы следующих методов класса Options:
| | |
|-|-|
| setMaxOpenFiles(-1)[4] | устранение ограничений на количество открытых файлов, доступных для обмена данными с БД в один и тот же момент времени |
| setAllowConcurrentMemtableWrite(true)[4] | разрешение параллельных операций записи в memtable |
| enableWriteThreadAdaptiveYield()[4] | установление предельной длительности записи в потоке, синхронизированном с <em>write batch group leader</em> (вплоть до момента блокировки мьютекса) |
| disableAutoCompactions()[4] | отключение автоматических уплотнений БД |
| setCompactionStyle(CompactionStyle.UNIVERSAL)[3][5] | выбор общего (universal) алгоритма уплотнения (в терминах RocksDB) |
| setCompactionOptionsUniversal[2] | изменение алгоритма сжатия данных (применение L4Z вместо SNAPPY по умолчанию) |

Справочные ресурсы:<br/>1. [github.com/facebook/rocksdb/wiki/](https://github.com/facebook/rocksdb/wiki)<br/>
2. [https://github.com/facebook/rocksdb/wiki/](https://github.com/facebook/rocksdb/wiki/Compression)
3. [github.com/tecbot/gorocksdb/](https://github.com/tecbot/gorocksdb/blob/master/options.go)<br/>
4. [javadoc.io](https://javadoc.io/doc/org.rocksdb/rocksdbjni/latest/index.html)<br/>
5. [zhangyuchi.gitbooks.io/rocksdbbook/](https://zhangyuchi.gitbooks.io/rocksdbbook/content/Universal-Compaction.html)<br/>  

<ins>Код в TaskDAO.java</ins>
```
public TaskDAO(@NotNull final File data) throws IOException {
            final Options opts = new Options();
            opts.setCreateIfMissing(true) // creates db instance if one does not exist
                .setMaxOpenFiles(-1)  // tunes max number of open files available for DB at the moment
                .setParanoidChecks(false) // drops strict data quality control while searching for corrupt items
                .setSkipStatsUpdateOnDbOpen(true) // abandons statistics updates every time db is opening to run
                .setAllowConcurrentMemtableWrite(true) // permits multithread memtable writes
                .enableWriteThreadAdaptiveYield(); // forces write batch to execute till mutex holding timeout

            opts.disableAutoCompactions(); // prevents from auto compactions as these are enabled by default
            opts.setCompactionStyle(CompactionStyle.UNIVERSAL) // applies universal (tiered) compaction algorithm
                .setCompactionOptionsUniversal(new CompactionOptionsUniversal()
                .setCompressionType(CompressionType.LZ4_COMPRESSION); // involves LZ4 as compression algorithm rather than SNAPPY

            dbLocalDir = data;
            try {
                Files.createDirectories(dbLocalDir.getParentFile().toPath());
                Files.createDirectories(dbLocalDir.getAbsoluteFile().toPath());
                db = RocksDB.open(opts, dbLocalDir.getAbsolutePath());
            } catch (IOException | RocksDBException exc) {
                logger.log(Level.SEVERE, "Storage initialization failed", exc);
            }
        }
```
### 2.1. PUT
<ins>Вывод <em>wrk</em></ins>
```
max@max-Inspiron-15-3573:~/hackdht$ wrk -t2 -c16 -d7m -s src/profiling/wrk_scripts/put.lua -R15000 --latency http://127.0.0.1:8080
Running 7m test @ http://127.0.0.1:8080
  2 threads and 16 connections
  Thread calibration: mean lat.: 213.988ms, rate sampling interval: 1414ms
  Thread calibration: mean lat.: 123.975ms, rate sampling interval: 844ms
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     2.70ms   13.85ms 398.34ms   99.09%
    Req/Sec     7.50k    86.34     8.77k    98.58%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%    1.34ms
 75.000%    1.92ms
 90.000%    2.64ms
 99.000%   14.90ms
 99.900%  234.11ms
 99.990%  346.11ms
 99.999%  390.14ms
100.000%  398.59ms

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.074     0.000000            1         1.00
       0.550     0.100000       616458         1.11
       0.774     0.200000      1231414         1.25
       0.967     0.300000      1846685         1.43
       1.149     0.400000      2460178         1.67
       1.336     0.500000      3076935         2.00
       1.436     0.550000      3385268         2.22
       1.540     0.600000      3689685         2.50
       1.653     0.650000      3998207         2.86
       1.777     0.700000      4305275         3.33
       1.918     0.750000      4613481         4.00
       1.997     0.775000      4766590         4.44
       2.083     0.800000      4919629         5.00
       2.181     0.825000      5073580         5.71
       2.297     0.850000      5227803         6.67
       2.441     0.875000      5381220         8.00
       2.531     0.887500      5458133         8.89
       2.637     0.900000      5534574        10.00
       2.777     0.912500      5612186        11.43
       2.967     0.925000      5688827        13.33
       3.263     0.937500      5765118        16.00
       3.513     0.943750      5803697        17.78
       3.933     0.950000      5842046        20.00
       4.687     0.956250      5880544        22.86
       5.747     0.962500      5918865        26.67
       6.887     0.968750      5957291        32.00
       7.503     0.971875      5976542        35.56
       8.215     0.975000      5995809        40.00
       9.063     0.978125      6014962        45.71
      10.055     0.981250      6034215        53.33
      11.191     0.984375      6053386        64.00
      11.871     0.985938      6063058        71.11
      12.695     0.987500      6072638        80.00
      13.847     0.989062      6082194        91.43
      15.943     0.990625      6091810       106.67
      24.239     0.992188      6101396       128.00
      38.079     0.992969      6106202       142.22
      56.447     0.993750      6111011       160.00
      78.143     0.994531      6115817       182.86
      97.407     0.995313      6120611       213.33
     117.631     0.996094      6125421       256.00
     129.279     0.996484      6127819       284.44
     141.183     0.996875      6130220       320.00
     154.751     0.997266      6132627       365.71
     169.983     0.997656      6135025       426.67
     188.415     0.998047      6137431       512.00
     197.375     0.998242      6138638       568.89
     206.335     0.998437      6139832       640.00
     214.143     0.998633      6141032       731.43
     224.383     0.998828      6142246       853.33
     235.775     0.999023      6143438      1024.00
     242.175     0.999121      6144038      1137.78
     251.775     0.999219      6144634      1280.00
     260.607     0.999316      6145238      1462.86
     269.055     0.999414      6145833      1706.67
     287.999     0.999512      6146435      2048.00
     296.447     0.999561      6146738      2275.56
     304.639     0.999609      6147036      2560.00
     310.271     0.999658      6147349      2925.71
     316.671     0.999707      6147648      3413.33
     322.303     0.999756      6147945      4096.00
     326.399     0.999780      6148091      4551.11
     329.983     0.999805      6148244      5120.00
     333.567     0.999829      6148397      5851.43
     336.383     0.999854      6148541      6826.67
     340.991     0.999878      6148692      8192.00
     344.319     0.999890      6148762      9102.22
     346.367     0.999902      6148838     10240.00
     348.671     0.999915      6148911     11702.86
     353.023     0.999927      6148987     13653.33
     355.071     0.999939      6149073     16384.00
     356.351     0.999945      6149105     18204.44
     357.375     0.999951      6149137     20480.00
     361.215     0.999957      6149175     23405.71
     368.639     0.999963      6149211     27306.67
     370.687     0.999969      6149251     32768.00
     376.319     0.999973      6149276     36408.89
     376.831     0.999976      6149290     40960.00
     378.111     0.999979      6149308     46811.43
     384.255     0.999982      6149324     54613.33
     386.815     0.999985      6149343     65536.00
     387.583     0.999986      6149354     72817.78
     388.351     0.999988      6149361     81920.00
     389.631     0.999989      6149373     93622.86
     390.655     0.999991      6149381    109226.67
     391.935     0.999992      6149392    131072.00
     392.191     0.999993      6149394    145635.56
     392.959     0.999994      6149399    163840.00
     393.727     0.999995      6149404    187245.71
     394.495     0.999995      6149409    218453.33
     395.263     0.999996      6149415    262144.00
     395.263     0.999997      6149415    291271.11
     395.519     0.999997      6149418    327680.00
     395.775     0.999997      6149422    374491.43
     395.775     0.999998      6149422    436906.67
     396.287     0.999998      6149427    524288.00
     396.287     0.999998      6149427    582542.22
     396.287     0.999998      6149427    655360.00
     396.543     0.999999      6149428    748982.86
     396.799     0.999999      6149429    873813.33
     397.823     0.999999      6149432   1048576.00
     397.823     0.999999      6149432   1165084.44
     397.823     0.999999      6149432   1310720.00
     397.823     0.999999      6149432   1497965.71
     398.079     0.999999      6149435   1747626.67
     398.079     1.000000      6149435   2097152.00
     398.079     1.000000      6149435   2330168.89
     398.079     1.000000      6149435   2621440.00
     398.079     1.000000      6149435   2995931.43
     398.079     1.000000      6149435   3495253.33
     398.079     1.000000      6149435   4194304.00
     398.079     1.000000      6149435   4660337.78
     398.079     1.000000      6149435   5242880.00
     398.079     1.000000      6149435   5991862.86
     398.591     1.000000      6149436   6990506.67
     398.591     1.000000      6149436          inf
#[Mean    =        2.701, StdDeviation   =       13.851]
#[Max     =      398.336, Total count    =      6149436]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  6299694 requests in 7.00m, 402.53MB read
Requests/sec:  14999.31
Transfer/sec:      0.96MB

```
При текущей конфигурации БД зафиксировано снижение времени отклика в верхнем диапазоне квантилей (99,999-100%), в то время как результаты, достигаемые в 99% и 99,9% случаев указывают на определённое превосходство базового варианта настроек. Можно предположить, что сдерживающим фактором, влияющим на потенциал ускорения сервера, является априори низкая производительность системы, использующей двухъядерный ЦПУ.    

### 2.2. GET
<ins>Вывод <em>wrk</em></ins>
```
max@max-Inspiron-15-3573:~/hackdht$ wrk -t2 -c16 -d7m -s src/profiling/wrk_scripts/get.lua -R15000 --latency http://127.0.0.1:8080
Running 7m test @ http://127.0.0.1:8080
  2 threads and 16 connections
  Thread calibration: mean lat.: 15.678ms, rate sampling interval: 51ms
  Thread calibration: mean lat.: 15.482ms, rate sampling interval: 40ms
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     1.71ms    2.09ms  66.30ms   94.66%
    Req/Sec     7.59k   432.52    12.60k    88.26%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%    1.32ms
 75.000%    1.91ms
 90.000%    2.68ms
 99.000%   10.52ms
 99.900%   24.33ms
 99.990%   51.52ms
 99.999%   60.93ms
100.000%   66.37ms

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.058     0.000000            1         1.00
       0.505     0.100000       616324         1.11
       0.737     0.200000      1229955         1.25
       0.940     0.300000      1847428         1.43
       1.132     0.400000      2462105         1.67
       1.324     0.500000      3077423         2.00
       1.424     0.550000      3383481         2.22
       1.529     0.600000      3690183         2.50
       1.643     0.650000      3999443         2.86
       1.769     0.700000      4306117         3.33
       1.911     0.750000      4612493         4.00
       1.992     0.775000      4766122         4.44
       2.081     0.800000      4919883         5.00
       2.183     0.825000      5073827         5.71
       2.305     0.850000      5227372         6.67
       2.459     0.875000      5380872         8.00
       2.559     0.887500      5458723         8.89
       2.679     0.900000      5535365        10.00
       2.837     0.912500      5611959        11.43
       3.055     0.925000      5688494        13.33
       3.393     0.937500      5765167        16.00
       3.649     0.943750      5803522        17.78
       4.019     0.950000      5841935        20.00
       4.535     0.956250      5880567        22.86
       5.171     0.962500      5918828        26.67
       5.903     0.968750      5957256        32.00
       6.307     0.971875      5976535        35.56
       6.739     0.975000      5995749        40.00
       7.223     0.978125      6014894        45.71
       7.787     0.981250      6034096        53.33
       8.519     0.984375      6053413        64.00
       8.975     0.985938      6063045        71.11
       9.487     0.987500      6072500        80.00
      10.111     0.989062      6082151        91.43
      10.807     0.990625      6091802       106.67
      11.599     0.992188      6101345       128.00
      12.055     0.992969      6106140       142.22
      12.575     0.993750      6110980       160.00
      13.151     0.994531      6115790       182.86
      13.823     0.995313      6120563       213.33
      14.663     0.996094      6125358       256.00
      15.167     0.996484      6127763       284.44
      15.775     0.996875      6130148       320.00
      16.511     0.997266      6132581       365.71
      17.423     0.997656      6134964       426.67
      18.703     0.998047      6137358       512.00
      19.455     0.998242      6138564       568.89
      20.335     0.998437      6139762       640.00
      21.423     0.998633      6140969       731.43
      22.751     0.998828      6142157       853.33
      24.607     0.999023      6143361      1024.00
      25.759     0.999121      6143959      1137.78
      27.167     0.999219      6144559      1280.00
      28.735     0.999316      6145164      1462.86
      30.783     0.999414      6145763      1706.67
      33.631     0.999512      6146365      2048.00
      35.423     0.999561      6146664      2275.56
      37.055     0.999609      6146963      2560.00
      38.591     0.999658      6147263      2925.71
      40.607     0.999707      6147565      3413.33
      43.775     0.999756      6147861      4096.00
      45.375     0.999780      6148013      4551.11
      47.135     0.999805      6148163      5120.00
      48.415     0.999829      6148312      5851.43
      49.343     0.999854      6148462      6826.67
      50.431     0.999878      6148614      8192.00
      51.039     0.999890      6148687      9102.22
      51.615     0.999902      6148767     10240.00
      52.383     0.999915      6148840     11702.86
      53.215     0.999927      6148913     13653.33
      54.399     0.999939      6148989     16384.00
      54.975     0.999945      6149026     18204.44
      55.583     0.999951      6149062     20480.00
      56.031     0.999957      6149103     23405.71
      56.543     0.999963      6149138     27306.67
      57.119     0.999969      6149175     32768.00
      57.503     0.999973      6149194     36408.89
      57.823     0.999976      6149212     40960.00
      58.271     0.999979      6149232     46811.43
      58.751     0.999982      6149250     54613.33
      59.487     0.999985      6149269     65536.00
      59.967     0.999986      6149279     72817.78
      60.287     0.999988      6149289     81920.00
      60.799     0.999989      6149297     93622.86
      61.055     0.999991      6149306    109226.67
      61.695     0.999992      6149316    131072.00
      61.887     0.999993      6149320    145635.56
      62.015     0.999994      6149325    163840.00
      62.399     0.999995      6149330    187245.71
      62.687     0.999995      6149334    218453.33
      62.911     0.999996      6149339    262144.00
      63.167     0.999997      6149341    291271.11
      63.263     0.999997      6149344    327680.00
      63.391     0.999997      6149347    374491.43
      63.423     0.999998      6149348    436906.67
      63.679     0.999998      6149351    524288.00
      63.743     0.999998      6149352    582542.22
      63.935     0.999998      6149353    655360.00
      64.191     0.999999      6149354    748982.86
      64.223     0.999999      6149356    873813.33
      64.735     0.999999      6149357   1048576.00
      64.735     0.999999      6149357   1165084.44
      65.023     0.999999      6149358   1310720.00
      65.023     0.999999      6149358   1497965.71
      65.087     0.999999      6149359   1747626.67
      65.535     1.000000      6149360   2097152.00
      65.535     1.000000      6149360   2330168.89
      65.535     1.000000      6149360   2621440.00
      65.535     1.000000      6149360   2995931.43
      65.791     1.000000      6149361   3495253.33
      65.791     1.000000      6149361   4194304.00
      65.791     1.000000      6149361   4660337.78
      65.791     1.000000      6149361   5242880.00
      65.791     1.000000      6149361   5991862.86
      66.367     1.000000      6149362   6990506.67
      66.367     1.000000      6149362          inf
#[Mean    =        1.713, StdDeviation   =        2.085]
#[Max     =       66.304, Total count    =      6149362]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  6299686 requests in 7.00m, 412.42MB read
  Non-2xx or 3xx responses: 8
Requests/sec:  14999.18
Transfer/sec:      0.98MB

```
Единственным значимым отличием текущей статистики следует назвать уменьшение максимального времени отклика (приблизительно на 40 мс относительно базовой конфигурации). Как и при анализе итогов предыдущей серии, требуется учитывать вероятность аппаратных ограничений, нивелирующих потенциал оптимизации и определяющих достаточную условность отмеченных изменений.       
